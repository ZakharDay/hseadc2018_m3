<% if user_signed_in? %>
  <%
    if product.users.where(id: current_user.id).count == 0
      text = "Add to favourites"
      class_name = "favourites on"
    else
      text = "Remove from favourites"
      class_name = "favourites off"
    end
  %>

  <%= link_to text, favourite_product_path(product), class: class_name, id: "product_#{product.id}", remote: true %>
<% else %>
  <%= link_to "Favourite", new_user_registration_path %>
<% end %>
